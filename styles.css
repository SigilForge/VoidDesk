:root { 
  --bg: #0b0b0f; 
  --panel: #11131a; 
  --ink: #e7e9ef; 
  --muted: #8a90a3; 
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font: 14px/1.5 ui-sans-serif, system-ui, Segoe UI, Roboto;
  background: var(--bg);
  color: var(--ink);
  display: flex;               /* eliminate bottom dead space */
  flex-direction: column;
  min-height: 100vh;
}

body.light {
  background: #f6f7fa;
  color: #222;
}
body.light .pane,
body.light .downloads,
body.light .settings {
  background: #fff;
  color: #222;
  border-color: #d0d3e0;
}

header {
  padding: 10px 12px;
  background: var(--panel);
  border-bottom: 1px solid #222634;
}
header h1 { 
  margin: 0 0 8px 0; 
  font-size: 16px; 
  letter-spacing: 0.6px; 
}

.row { 
  display: flex; 
  gap: 8px; 
  align-items: center; 
  flex-wrap: wrap; 
}

label { 
  display: flex; 
  gap: 8px; 
  align-items: center; 
  color: var(--muted); 
}

label input, select {
  background: #0e1016;
  color: var(--ink);
  border: 1px solid #2a2f45;
  border-radius: 8px;
  padding: 6px 8px;
}

#saveCfg, #clear, #send, #apiMode, #plusMode, #sendOther, #logoutPlus {
  background: #1a1f33;
  color: var(--ink);
  border: 1px solid #2a2f45;
  border-radius: 10px;
  padding: 6px 10px;
  cursor: pointer;
}
#saveCfg:hover, #clear:hover, #send:hover, .mode:hover, #sendOther:hover, #logoutPlus:hover { 
  filter: brightness(1.15); 
}

.mode-toggle { 
  display: inline-flex; 
  border: 1px solid #2a2f45; 
  border-radius: 10px; 
  overflow: hidden; 
}
.mode { 
  border: none; 
  background: #12172a; 
}
.mode.active { 
  background: #1f2750; 
}

.syslabel { 
  margin-top: 6px; 
  display: block; 
}
#system { 
  width: 100%; 
  margin-top: 4px; 
}

/* Refresh button: dark pill + SVG + Knight Rider sweep */
#refresh {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #1a1f33;
  color: var(--ink);
  border: 1px solid #2a2f45;
  border-radius: 10px;
  padding: 6px 12px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  line-height: 1;
}

#refresh:hover { filter: brightness(1.15); }

#refresh svg {
  width: 14px;
  height: 14px;
  flex: 0 0 auto;
}

/* Knight Rider sweep overlay */
@keyframes refreshSweep {
  0%   { transform: translateX(-120%); }
  50%  { transform: translateX(120%); }
  100% { transform: translateX(-120%); }
}

#refresh.knight::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 0, 60, 0.18) 45%,
    rgba(255, 106, 136, 0.35) 50%,
    rgba(255, 0, 60, 0.18) 55%,
    transparent 100%
  );
  transform: translateX(-120%);
  animation: refreshSweep 1.2s linear infinite;
}

/* Breathing icon while refreshing */
@keyframes breathe {
  0%, 100% { opacity: 1; transform: scale(1); }
  50%      { opacity: 0.6; transform: scale(1.15); }
}

#refresh.knight svg {
  animation: breathe 1.2s ease-in-out infinite;
}

/* Danger state when holding Shift */
#refresh.danger {
  background: #5a1321 !important; /* dark red base */
  border-color: #ff375f !important;
  box-shadow: 0 0 8px rgba(255, 55, 95, 0.6);
}

#refresh.danger:hover {
  filter: brightness(1.2);
}

main {
  flex: 1;             
  min-height: 0;       
  overflow: hidden;    
}

.pane {
  height: 100%;
  display: flex;       
  flex-direction: column;
}

.hidden { display: none; }

#chat {
  padding: 12px;
  flex: 1;             
  min-height: 0;
  overflow-y: auto;
}

.msg {
  padding: 10px 12px;
  border: 1px solid #2a2f45;
  border-radius: 12px;
  margin: 8px 0;
  white-space: pre-wrap;
}
.msg.user { background: #101320; }
.msg.assistant { background: #0f1424; }

footer {
  display: flex;
  gap: 8px;
  padding: 12px;
  background: var(--panel);
  border-top: 1px solid #222634;
}

/* tiny toasts for downloads */
.toasts {
  position: fixed;
  right: 12px;
  bottom: 12px;
  display: grid;
  gap: 8px;
  z-index: 1000;
}
.toast {
  background: #12172a;
  border: 1px solid #2a2f45;
  border-radius: 10px;
  padding: 8px 10px;
  font-size: 12px;
  color: var(--ink);
  opacity: 0.9;
}

#downloadsBtn {
  background: #1a1f33;
  color: var(--ink);
  border: 1px solid #2a2f45;
  border-radius: 20px; /* pill style */
  padding: 6px 18px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: filter 0.15s, box-shadow 0.15s, border-color 0.15s;
}
#downloadsBtn:hover { 
  filter: brightness(1.15); 
  box-shadow: 0 2px 12px 0 rgba(34, 38, 52, 0.2);
}
#downloadsBtn.knight {
  animation: knight-rider 1.2s linear infinite;
  border-color: #ff375f;
}

@keyframes knight-rider {
  0%   { box-shadow: inset 0 0 0 0 rgba(255, 55, 95, 0); }
  50%  { box-shadow: inset 0 0 0 2px rgba(255, 55, 95, 0.6), 0 0 12px 0 rgba(255, 55, 95, 0.35); }
  100% { box-shadow: inset 0 0 0 0 rgba(255, 55, 95, 0); }
}

/* Downloads panel */
.downloads { 
  position: fixed; 
  right: 12px; 
  bottom: 60px; 
  width: 360px;
  background: #12172a; 
  border: 1px solid #2a2f45; 
  border-radius: 12px;
  padding: 10px; 
  z-index: 1001;
}
.downloads.hidden { display: none; }
.downloads-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 8px; 
}
.downloads-list { 
  display: grid; 
  gap: 6px; 
  max-height: 300px; 
  overflow: auto; 
}
.dl-item { 
  border: 1px solid #2a2f45; 
  border-radius: 10px; 
  padding: 8px; 
  background: #181c2c;
}
.dl-row { 
  display: flex; 
  justify-content: space-between; 
  gap: 8px; 
}
.dl-name { 
  font-size: 12px; 
  overflow: hidden; 
  text-overflow: ellipsis; 
}
.dl-meta {
  font-size: 11px;
  color: var(--muted);
}

progress { 
  width: 100%; 
  height: 6px; 
  accent-color: #ff375f;
}

/* Removed stray JavaScript from CSS; move these handlers to a JS file:
   window.VoidDesk.downloads.onStart(() => {
     downloadsBtn.classList.remove('knight');
     void downloadsBtn.offsetWidth;
     downloadsBtn.classList.add('knight');
   });
   window.VoidDesk.downloads.onDone(() => {
     downloadsBtn.classList.remove('knight');
   });
*/

.settings {
  position: fixed; top: 60px; right: 24px; width: 320px;
  background: #181c2c; border: 1px solid #2a2f45; border-radius: 14px;
  z-index: 2000; padding: 18px 18px 12px; box-shadow: 0 4px 24px rgba(0, 0, 0, 0.67);
}
.settings.hidden { display: none; }
.settings-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; font-size:18px; font-weight:600; }
.settings-list label { display:block; margin-bottom:12px; font-size:14px; }
#saveSettings { margin-top:8px; width:100%; border-radius:10px; background:#1a1f33; color:var(--ink); border:1px solid #2a2f45; padding:8px 0; cursor:pointer; font-size:15px; font-weight:500; }
/* Settings button = same pill look as Downloads/Test DL */
#settingsBtn {
  background: #1a1f33;
  color: var(--ink);
  border: 1px solid #2a2f45;
  border-radius: 20px;
  padding: 6px 18px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: filter 0.15s, box-shadow 0.15s, border-color 0.15s;
}
#settingsBtn:hover {
  filter: brightness(1.15);
  box-shadow: 0 2px 12px 0 rgba(34, 38, 52, 0.2);
}
